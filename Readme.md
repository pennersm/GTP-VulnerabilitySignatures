# GTP-C Message Type Filters

This tool will add Custom Vulnerability Signatures to the NGFW and activate them in a separate, new Vulnerability profile. Signatures are based on GTPv1-C and GTPv2-C specific Message type Ranges.

At the end of this file you find a more detailed description of the functionality. This is important as the filters need to be tuned.
**NOTE** Do not just run the script and then let the filters unconfigured! You might just end up creating a flood of meaningless Threat-Alerts and spam the threatlog. intention is, to use only those Filters that match the service and GTP-C setup of an operator!




## Usage
To add the filters to the NGFW you only need to run the script '''gtp_cat1_filters'''. All other content of the repo is only for generating tests and further fiddling.

### NGFW authentication
The script uses python request library to trigger the PANOS REST API. In order to send REST API requests with this script, you have to set up authentication:
If you do not have installed external certificates on your NGFW, then your are using a self-signed certificate for https connection to the GUI. (default).
- in order to use request library with self-signed certificates, you need to have the "verify=no" option set in the requests. This is how the code is delivered here and it works with FW default setup.
- in case you have external certificates in use, you can remove the verify=no clause and instead add your local certificate path.
- regardless of certificates you **need to set up user authentication**, you must base64-encode your username and password.  Find a link to the documentation inside the code

**NOTE:**
This script is likely ran once only on a FW, and it is done from a admin computer. Hence there is no need to sopend a lot into authentication settings here!

### run the script
All you need to do is call the script from command line. You must have python installed and the imported libraries in the beginning of the script must be available (use pip if missing some)

## Detail Functionality
will need to add some explanation here on how to tune the filters. Idea is:
- Both the GTPv1-C and GTPv2-C protocol have Categories of messages (Tunnel Mgmnt, Path Mgmnt, Mobility Mgmnt ...)
- Tunnel- and Path Mgmnt Messages are ALWAYS needed if any GTP connection is to be established. Therefore, there are NO Signatures created by this script that would trigger on Path- or Tunnel Mgmnt messages.
- After running the script you will find a new Vulnerability Profile "GTP-C-Signatures" and within this profile all new custom signatures are added and active.
- Go to the new profile, exceptions tab, you see a list of all new signatures: 41100-41999 GTPv1-C related, 41200-41299 GTPv2-C related.  Each Signature has a description, reference to GSMA or 3GPP spec and shows the Message Type Range in its description.
- Now you have to tune the signatures by disabling (i.e. untick the exception) and only keep those signatures from which you want alerts.

Clarify for each Message Type Range (Signature), if the customer uses corresponding type of messaging in the segment where you want to apply the rule that uses the profile. For example:
- if Sv interface, S101, S102 etc are **not** used, then alert on those signatures (keep exceptions)
- if call-tracing, DL-data-notification, ... are used, then do not alert on those messages (disable exceptions)
- If you are using the signatures on a roaming interconnect, you can leave all Signatures enabled and it should reflect a restrictive CAT-1 Filter (some services like reset messages etc **might** still be needed on the interconnect, you can then fine tune based on condition. It is also OK to change the MSG type ranges in the signature definitions.)
